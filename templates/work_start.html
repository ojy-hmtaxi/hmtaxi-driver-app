{% extends "base.html" %}

{% block title %}근무준비 - 근무 관리 시스템{% endblock %}

{% block content %}
<div class="work-prepare-container">
    <div class="work-prepare-header">
        <a href="{{ url_for('calendar_view') }}" class="back-button">‹</a>
        <h1>근무준비</h1>
    </div>
    
    <div class="work-prepare-box">
        <form method="POST" action="{{ url_for('work_start') }}" class="work-prepare-form" id="workPrepareForm">
            <div class="form-group">
                <label>운행 차량</label>
                {% if assigned_vehicle %}
                    <div class="vehicle-display">
                        서울{{ assigned_vehicle }}{% if assigned_vehicle_type %} - {{ assigned_vehicle_type }}{% endif %}
                    </div>
                    <input type="hidden" name="vehicle_number" value="{{ assigned_vehicle }}">
                {% else %}
                    <div class="vehicle-display vehicle-not-assigned">
                        배정된 차량이 없습니다.
                    </div>
                    <input type="hidden" name="vehicle_number" value="">
                {% endif %}
            </div>

            <div class="form-group">
                <label>근무예정일 확인</label>
                <div class="warning-message">
                    ※ 야간 운행시작일이 근무예정일보다 늦은 경우,<br>날짜를 하루 전으로 설정해 주세요.
                </div>
                <div class="date-selector">
                    <button type="button" class="date-btn date-btn-minus" id="dateMinusBtn"><i class="bi bi-dash-circle-fill"></i></button>
                    <div class="date-display-selector" id="selectedDateDisplay">{{ year }} / {{ month }} / {{ day }}</div>
                    <button type="button" class="date-btn date-btn-plus" id="datePlusBtn"><i class="bi bi-plus-circle-fill"></i></button>
                </div>
                <input type="hidden" name="selected_date" id="selectedDateInput" value="{{ year }}-{{ month }}-{{ day }}">
            </div>
            
            <div class="form-group">
                <label for="work_date">운행시작일시</label>
                <div class="date-display">{{ work_datetime_display }}</div>
                <div class="work-type-toggle">
                    <input type="radio" id="work_type_day" name="work_type" value="주간" {% if work_type_from_sheet == '주간' %}checked{% endif %} disabled>
                    <label for="work_type_day" class="toggle-btn {% if work_type_from_sheet == '주간' %}toggle-active{% endif %}">주간</label>
                    
                    <input type="radio" id="work_type_night" name="work_type" value="야간" {% if work_type_from_sheet == '야간' %}checked{% endif %} disabled>
                    <label for="work_type_night" class="toggle-btn {% if work_type_from_sheet == '야간' %}toggle-active{% endif %}">야간</label>
                    
                    <input type="radio" id="work_type_daily" name="work_type" value="일차" {% if work_type_from_sheet == '일차' %}checked{% endif %} disabled>
                    <label for="work_type_daily" class="toggle-btn {% if work_type_from_sheet == '일차' %}toggle-active{% endif %}">일차</label>
                    
                    <input type="radio" id="work_type_shift" name="work_type" value="교대" {% if work_type_from_sheet == '교대' %}checked{% endif %} disabled>
                    <label for="work_type_shift" class="toggle-btn {% if work_type_from_sheet == '교대' %}toggle-active{% endif %}">교대</label>
                    
                    <input type="radio" id="work_type_lease" name="work_type" value="리스" {% if work_type_from_sheet == '리스' %}checked{% endif %} disabled>
                    <label for="work_type_lease" class="toggle-btn {% if work_type_from_sheet == '리스' %}toggle-active{% endif %}">리스</label>
                </div>
                <input type="hidden" name="work_type" value="{{ work_type_from_sheet }}">
            </div>
            
            <div class="form-group">
                <label>보고사항 (선택)</label>
                <div class="vehicle-status-toggle">
                    <input type="radio" id="vehicle_good" name="vehicle_condition" value="○ ○" checked>
                    <label for="vehicle_good" class="status-btn status-good status-active">
                        <span class="status-icon">✓</span> ○ ○
                    </label>
                    
                    <input type="radio" id="vehicle_bad" name="vehicle_condition" value="△ △">
                    <label for="vehicle_bad" class="status-btn status-bad">
                        <span class="status-icon">△</span> △ △
                    </label>
                    
                    <input type="radio" id="vehicle_repair" name="vehicle_condition" value="□ □">
                    <label for="vehicle_repair" class="status-btn status-repair">
                        <span class="status-icon">○</span> □ □
                    </label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="special_notes">특기사항 (선택)</label>
                <textarea id="special_notes" 
                          name="special_notes" 
                          rows="3" 
                          placeholder="특기사항을 입력하세요"></textarea>
            </div>

            <div class="warning-message">
                ※ 완료 후, 개인 수정 불가합니다.
            </div>
            
            <button type="submit" class="btn btn-primary btn-block btn-large btn-work-start">근무시작</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 근무유형 토글은 읽기 전용이므로 클릭 이벤트 제거
    
    // 상태 버튼 스타일 업데이트
    const statusButtons = document.querySelectorAll('.status-btn');
    statusButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            statusButtons.forEach(b => b.classList.remove('status-active'));
            this.classList.add('status-active');
        });
    });
    
    // 날짜 선택 기능
    const dateMinusBtn = document.getElementById('dateMinusBtn');
    const datePlusBtn = document.getElementById('datePlusBtn');
    const selectedDateDisplay = document.getElementById('selectedDateDisplay');
    const selectedDateInput = document.getElementById('selectedDateInput');
    
    // 초기 날짜 설정
    const initialYear = parseInt('{{ year }}', 10);
    const initialMonth = parseInt('{{ month }}', 10);
    const initialDay = parseInt('{{ day }}', 10);
    let currentDate = new Date(initialYear, initialMonth - 1, initialDay);
    
    function updateDateDisplay() {
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0');
        const day = String(currentDate.getDate()).padStart(2, '0');
        
        selectedDateDisplay.textContent = year + ' / ' + month + ' / ' + day;
        selectedDateInput.value = year + '-' + month + '-' + day;
    }
    
    dateMinusBtn.addEventListener('click', function() {
        currentDate.setDate(currentDate.getDate() - 1);
        updateDateDisplay();
    });
    
    datePlusBtn.addEventListener('click', function() {
        currentDate.setDate(currentDate.getDate() + 1);
        updateDateDisplay();
    });
});
</script>
{% endblock %}

