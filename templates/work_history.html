{% extends "base.html" %}

{% block title %}근무이력 - 근무 관리 시스템{% endblock %}

{% block extra_head %}
<link rel="prefetch" href="{{ url_for('calendar_view') }}">
{% endblock %}

{% block content %}
<div class="work-history-container">
    <div class="header">
        <h1>월별 근무이력</h1>
        <div class="navigation">
            <a href="{{ url_for('calendar_view') }}" class="btn btn-secondary btn-sm">캘린더로</a>
            <a href="{{ url_for('work_start') }}" class="btn btn-primary btn-sm">근무시작</a>
        </div>
    </div>
    
    {% if chart_data %}
    <div class="chart-container">
        <canvas id="workHistoryChart"></canvas>
    </div>
    
    <div class="history-table">
        <h3>월별 근무 통계</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>월</th>
                    <th>근무일수</th>
                    <th>결근일수</th>
                    <th>예정일수</th>
                    <th>휴무일수</th>
                    <th>합계</th>
                </tr>
            </thead>
            <tbody>
                {% for i in range(chart_data.months|length) %}
                <tr>
                    <td>{{ chart_data.months[i] }}</td>
                    <td>{{ chart_data.work_days[i] | int }}</td>
                    <td>{{ chart_data.absent_days[i] | int }}</td>
                    <td>{{ chart_data.scheduled_days[i] | int }}</td>
                    <td>{{ chart_data.holiday_days[i] | int }}</td>
                    <td>{{ (chart_data.work_days[i] | int) + (chart_data.absent_days[i] | int) + (chart_data.scheduled_days[i] | int) + (chart_data.holiday_days[i] | int) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="no-data">
        <p>근무 이력 데이터가 없습니다.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
{% if chart_data %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('workHistoryChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ chart_data.months | tojson }},
        datasets: [{
            label: '근무일수',
            data: {{ chart_data.work_days | tojson }},
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }, {
            label: '결근일수',
            data: {{ chart_data.absent_days | tojson }},
            backgroundColor: 'rgba(255, 99, 132, 0.5)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 1
        }, {
            label: '예정일수',
            data: {{ chart_data.scheduled_days | tojson }},
            backgroundColor: 'rgba(23, 162, 184, 0.5)',
            borderColor: 'rgba(23, 162, 184, 1)',
            borderWidth: 1
        }, {
            label: '휴무일수',
            data: {{ chart_data.holiday_days | tojson }},
            backgroundColor: 'rgba(255, 193, 7, 0.5)',
            borderColor: 'rgba(255, 193, 7, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endif %}
{% endblock %}

