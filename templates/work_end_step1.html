{% extends "base.html" %}

{% block title %}근무종료 - 근무 관리 시스템{% endblock %}

{% block extra_head %}
<link rel="prefetch" href="{{ url_for('calendar_view') }}">
{% endblock %}

{% block content %}
<div class="work-prepare-container">
    <div class="work-prepare-header">
        <a href="{{ url_for('calendar_view') }}" class="back-button">‹</a>
        <h1>근무종료</h1>
    </div>
    
    <div class="work-prepare-box">
        <form method="POST" action="{{ url_for('work_end') }}" class="work-prepare-form" id="workEndStep1Form">
            <div class="form-group">
                <label>운행 차량</label>
                {% if assigned_vehicle %}
                    <div class="vehicle-display">
                        서울{{ assigned_vehicle }}{% if assigned_vehicle_type %} - {{ assigned_vehicle_type }}{% endif %}
                    </div>
                    <input type="hidden" name="vehicle_number" value="{{ assigned_vehicle }}">
                    {% else %}
                    <div class="vehicle-display vehicle-not-assigned">
                        배정된 차량이 없습니다.
                    </div>
                    <input type="hidden" name="vehicle_number" value="">
                    {% endif %}
            </div>
            
            <div class="form-group">
                <label for="work_date">운행일</label>
                <div class="date-display">{{ work_date_display }}</div>
                <div class="work-type-toggle">
                    <input type="radio" id="work_type_day" name="work_type" value="주간" {% if work_type_from_sheet == '주간' %}checked{% endif %} disabled>
                    <label for="work_type_day" class="toggle-btn {% if work_type_from_sheet == '주간' %}toggle-active{% endif %}">주간</label>
                    
                    <input type="radio" id="work_type_night" name="work_type" value="야간" {% if work_type_from_sheet == '야간' %}checked{% endif %} disabled>
                    <label for="work_type_night" class="toggle-btn {% if work_type_from_sheet == '야간' %}toggle-active{% endif %}">야간</label>
                    
                    <input type="radio" id="work_type_daily" name="work_type" value="일차" {% if work_type_from_sheet == '일차' %}checked{% endif %} disabled>
                    <label for="work_type_daily" class="toggle-btn {% if work_type_from_sheet == '일차' %}toggle-active{% endif %}">일차</label>
                    
                    <input type="radio" id="work_type_shift" name="work_type" value="교대" {% if work_type_from_sheet == '교대' %}checked{% endif %} disabled>
                    <label for="work_type_shift" class="toggle-btn {% if work_type_from_sheet == '교대' %}toggle-active{% endif %}">교대</label>
                    
                    <input type="radio" id="work_type_lease" name="work_type" value="리스" {% if work_type_from_sheet == '리스' %}checked{% endif %} disabled>
                    <label for="work_type_lease" class="toggle-btn {% if work_type_from_sheet == '리스' %}toggle-active{% endif %}">리스</label>
                </div>
                <input type="hidden" name="work_type" value="{{ work_type_from_sheet }}">
            </div>
            
            <div class="form-group">
                <label>사고유무 <span class="required">*</span></label>
                <div class="vehicle-status-toggle">
                    <input type="radio" id="accident_none" name="accident_status" value="무사고" required>
                    <label for="accident_none" class="status-btn status-good">
                        <span class="status-icon">✓</span> 무사고
                    </label>
                    
                    <input type="radio" id="accident_at_fault" name="accident_status" value="가해사고" required>
                    <label for="accident_at_fault" class="status-btn status-bad">
                        <span class="status-icon">⚠</span> 가해사고
                    </label>
                    
                    <input type="radio" id="accident_victim" name="accident_status" value="피해사고" required>
                    <label for="accident_victim" class="status-btn status-repair">
                        <span class="status-icon">⛨</span> 피해사고
                    </label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="special_notes">보고사항 (선택)</label>
                <textarea id="special_notes" 
                          name="special_notes" 
                          rows="3" 
                          placeholder="교통사고, 법규위반, 고장, 습득물 등 보고사항을 간략하게 작성해 주세요.">{{ default_special_notes }}</textarea>
            </div>
            
            <button type="submit" class="btn btn-danger btn-block btn-large btn-work-end-step1">다음단계 ▶</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 근무유형 토글은 읽기 전용이므로 클릭 이벤트 제거
    
    // 사고유무 버튼 스타일 업데이트
    const statusButtons = document.querySelectorAll('.status-btn');
    statusButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            statusButtons.forEach(b => b.classList.remove('status-active'));
            this.classList.add('status-active');
            // 라디오 버튼도 함께 선택
            const radio = this.previousElementSibling;
            if (radio && radio.type === 'radio') {
                radio.checked = true;
            }
        });
    });
    
    // 폼 제출 시 사고유무 필수 검증
    const form = document.getElementById('workEndStep1Form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const accidentStatus = document.querySelector('input[name="accident_status"]:checked');
            if (!accidentStatus) {
                e.preventDefault();
                alert('사고유무를 선택해주세요.');
                return false;
            }
        });
    }
});
</script>
{% endblock %}


